apiVersion: v1
data:
  config.alloy: "logging {\n    level  = \"info\"\n    format = \"logfmt\"\n}\n\n//
    ============================================================================\n//
    OTLP Receivers - Accept telemetry from FastAPI\n// ============================================================================\notelcol.receiver.otlp
    \"default\" {\n  grpc {\n    endpoint = \"0.0.0.0:4317\"\n  }\n\n  http {\n    endpoint
    = \"0.0.0.0:4318\"\n  }\n\n  output {\n    metrics = [otelcol.processor.batch.default.input]\n
    \   logs    = [otelcol.processor.batch.default.input]\n    traces  = [otelcol.processor.batch.default.input]\n
    \ }\n}\n\n// ============================================================================\n//
    Processors\n// ============================================================================\notelcol.processor.batch
    \"default\" {\n  timeout = \"2s\"\n  send_batch_size = 512\n  \n  output {\n    metrics
    = [otelcol.exporter.prometheus.default.input]\n    logs    = [otelcol.exporter.loki.default.input]\n
    \   traces  = [otelcol.exporter.otlp.tempo.input]\n  }\n}\n\n// ============================================================================\n//
    Exporters\n// ============================================================================\n\n//
    Export traces to Tempo\notelcol.exporter.otlp \"tempo\" {\n  client {\n    endpoint
    = \"tempo.monitoring.svc.cluster.local:4317\"\n    tls {\n      insecure = true\n
    \   }\n  }\n}\n\n// Export logs to Loki\notelcol.exporter.loki \"default\" {\n
    \ forward_to = [loki.write.default.receiver]\n}\n\nloki.write \"default\" {\n
    \ endpoint {\n    url = \"http://loki-gateway.monitoring.svc.cluster.local:80/loki/api/v1/push\"\n
    \ }\n  headers {\n    \"X-Scope-OrgID\" = \"neo-dev\"\n  }\n}\n\n// Export metrics
    to Prometheus\notelcol.exporter.prometheus \"default\" {\n  forward_to = [prometheus.remote_write.default.receiver]\n}\n\nprometheus.remote_write
    \"default\" {\n  endpoint {\n    url = \"http://monitoring-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090/api/v1/write\"\n
    \ }\n}\n\n// ============================================================================\n//
    Kubernetes Service Discovery (existing)\n// ============================================================================\ndiscovery.kubernetes
    \"pods\" {\n    role = \"pod\"\n}\n\ndiscovery.kubernetes \"nodes\" {\n    role
    = \"node\"\n}\n\ndiscovery.kubernetes \"services\" {\n    role = \"service\"\n}\n\ndiscovery.kubernetes
    \"endpoints\" {\n    role = \"endpoints\"\n}\n\ndiscovery.kubernetes \"endpointslices\"
    {\n    role = \"endpointslice\"\n}\n\ndiscovery.kubernetes \"ingresses\" {\n    role
    = \"ingress\"\n}\n"
kind: ConfigMap
metadata:
  name: alloy
  namespace: monitoring
